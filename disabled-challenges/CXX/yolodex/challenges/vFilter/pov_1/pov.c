#include "libpov.h"

unsigned char pov_data[] = {
  0x2c, 0x00, 0x00, 0x00, 0xb3, 0x05, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0xbb, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x54, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0xbb, 0x00, 0x00, 0x00, 0xcd, 0xab, 0x89, 0x67,
  0xbb, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x8b, 0x01, 0x00, 0x00,
  0x01, 0x00, 0x00, 0x00, 0xb3, 0x13, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x12, 0x3f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf5, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x03, 0xf5, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x0b, 0x05, 0x00, 0x00, 0x00, 0xc0, 0x67, 0x8b, 0x10, 0x53, 0xcf, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x7b, 0x03, 0x00, 0x00, 0xef, 0xbe, 0xad, 0xde,
  0xb3, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xb3, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0xb3, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0xb3, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xb3, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0xb3, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0xb3, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xb3, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0xb3, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0xb3, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xb3, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0xb3, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0xb3, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xb3, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0xb3, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0xb3, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xb3, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0xb3, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0xb3, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xb3, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0xb3, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0xb3, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xb3, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0xb3, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0xb3, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xb3, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0xb3, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0xb3, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xb3, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0xb3, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x54, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x21, 0x00, 0x00, 0x00,
  0xcd, 0x34, 0xab, 0x12, 0x03, 0x00, 0xfc, 0xaf, 0xa6, 0xb2, 0x00, 0x00,
  0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x01, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00
};
int pov_length = 393;

int main(int cgc_argc, char *cgc_argv[])
{
    unsigned int xorkey;
    unsigned char resp[6];
    cgc_size_t bytes;
    type2_vals vals;

    cgc_type2_negotiate(&vals);

    cgc_transmit_all(STDOUT, "31lk", 4);

    cgc_random(&xorkey, 4, &bytes);
    *(unsigned int *)&pov_data[104] = xorkey;
    cgc_random(&pov_data[32], 2, &bytes);

    cgc_transmit_all(STDOUT, pov_data, pov_length);
    cgc_length_read(STDIN, resp, 6);

    *(unsigned int *)&resp[2] ^= xorkey;

    cgc_type2_submit(&resp[2], 4);
    return 0;
}
